services:
  webapp-dev:
    container_name: webapp-dev
    build:
      context: ./webapp
      dockerfile: /docker/dev.Dockerfile

    # Set environment variables directly in the docker-compose file
    # environment:
    #   ENV_VARIABLE: ${ENV_VARIABLE}
    #   NEXT_PUBLIC_ENV_VARIABLE: ${NEXT_PUBLIC_ENV_VARIABLE}

    # Set environment variables based on the .env file
    env_file:
      - .env
    restart: always
    ports:
      - 3000:3000
    develop:
      watch:
        - action: sync
          path: ./webapp/src
          target: /app/src
          ignore:
            - node_modules/
        - action: rebuild
          path: package.json

  db:
    image: postgres:16-alpine
    container_name: postgres
    restart: always
    environment:
      POSTGRES_PASSWORD: example
      TZ: Europe/Bucharest
    ports:
      - "5432:5432"
    volumes:
      - ./db:/var/lib/postgresql/data
